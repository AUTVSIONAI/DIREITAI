<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Login</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste de Login Supabase</h1>
    <div>
        <input type="email" id="email" placeholder="Email" value="admin@direitai.com">
        <input type="password" id="password" placeholder="Senha" value="GTUVX809XLQ@">
        <button onclick="testLogin()">Testar Login</button>
    </div>
    <div id="result"></div>

    <script>
        const supabaseUrl = 'https://vussgslenvyztckeuyap.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1c3Nnc2xlbnZ5enRja2V1eWFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyODE5ODUsImV4cCI6MjA2OTg1Nzk4NX0.a3WlLKS1HrSCqWuG80goBsoUaUhtpRsV8mqmTAYpIAo'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        async function testLogin() {
            const email = document.getElementById('email').value
            const password = document.getElementById('password').value
            const resultDiv = document.getElementById('result')
            
            console.log('Tentando login com:', email)
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                })
                
                if (error) {
                    console.error('Erro no login:', error)
                    resultDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`
                } else {
                    console.log('Login bem-sucedido:', data)
                    resultDiv.innerHTML = `<p style="color: green;">Login bem-sucedido! User ID: ${data.user.id}</p>`
                    
                    // Testar busca do perfil
                    const { data: profile, error: profileError } = await supabase
                        .from('users')
                        .select('*')
                        .eq('auth_id', data.user.id)
                        .single()
                    
                    if (profileError) {
                        console.error('Erro ao buscar perfil:', profileError)
                        resultDiv.innerHTML += `<p style="color: orange;">Perfil n√£o encontrado: ${profileError.message}</p>`
                    } else {
                        console.log('Perfil encontrado:', profile)
                        resultDiv.innerHTML += `<p style="color: blue;">Perfil: ${profile.full_name}</p>`
                    }
                }
            } catch (err) {
                console.error('Erro geral:', err)
                resultDiv.innerHTML = `<p style="color: red;">Erro geral: ${err.message}</p>`
            }
        }
    </script>
</body>
</html>